{"version":3,"names":["Platform","React","useEffect","useRef","BBBN_SystemBroadcastPicker","WebView","handleWebviewMessage","onScreenShareLocalIceCandidate","onScreenShareSignalingStateChange","onBroadcastFinished","data","instances","renderPlatformSpecificComponents","select","ios","android","BigBlueButtonTablet","url","style","onError","onSuccess","webViewRef","thisInstanceId","logPrefix","substring","console","log","listeners","push","setupListener","forEach","listener","index","remove","uri","msg","content","nativeEvent","code"],"sources":["index.tsx"],"sourcesContent":["import { EmitterSubscription, Platform, ViewStyle } from 'react-native';\nimport React, { useEffect, useRef } from 'react';\nimport BBBN_SystemBroadcastPicker from './native-components/BBBN_SystemBroadcastPicker';\nimport { WebView } from 'react-native-webview';\nimport { handleWebviewMessage } from './webview/message-handler';\nimport * as onScreenShareLocalIceCandidate from './events/onScreenShareLocalIceCandidate';\nimport * as onScreenShareSignalingStateChange from './events/onScreenShareSignalingStateChange';\nimport * as onBroadcastFinished from './events/onBroadcastFinished';\n\ntype BigBlueButtonTabletSdkProps = {\n  url: string;\n  style: ViewStyle;\n  onError?: any;\n  onSuccess?: any;\n};\n\nconst data = {\n  instances: 0,\n};\n\nconst renderPlatformSpecificComponents = () =>\n  Platform.select({\n    ios: <BBBN_SystemBroadcastPicker />,\n    android: null,\n  });\n\nexport const BigBlueButtonTablet = ({\n  url,\n  style,\n  onError,\n  onSuccess,\n}: BigBlueButtonTabletSdkProps) => {\n  const webViewRef = useRef(null);\n  const thisInstanceId = ++data.instances;\n\n  // console.log(\"XXX - \", thisInstanceId);\n\n  useEffect(() => {\n    const logPrefix = `[${thisInstanceId}] - ${url.substring(8, 16)}`;\n\n    console.log(`${logPrefix} - addingListeners`);\n    const listeners: EmitterSubscription[] = [];\n    listeners.push(onScreenShareLocalIceCandidate.setupListener(webViewRef));\n    listeners.push(onScreenShareSignalingStateChange.setupListener(webViewRef));\n    listeners.push(onBroadcastFinished.setupListener(webViewRef));\n\n    return () => {\n      console.log(`${logPrefix} - Removing listeners`);\n\n      listeners.forEach((listener, index) => {\n        console.log(`${logPrefix} - Removing listener ${index}`);\n        listener.remove();\n      });\n    };\n  }, [webViewRef, thisInstanceId, url]);\n\n  return (\n    <>\n      {renderPlatformSpecificComponents()}\n      {\n        <WebView\n          ref={webViewRef}\n          source={{ uri: url }}\n          style={{ ...style }}\n          contentMode={'mobile'}\n          onMessage={(msg: any) =>\n            handleWebviewMessage(thisInstanceId, webViewRef, msg)\n          }\n          applicationNameForUserAgent=\"BigBlueButton-Tablet\"\n          allowsInlineMediaPlayback={true}\n          mediaCapturePermissionGrantType={'grant'}\n          onLoadEnd={(content: any) => {\n            /*in case of success, the property code is not defined*/\n            if (typeof content.nativeEvent.code !== 'undefined') {\n              if (onError) onError(content);\n            } else {\n              if (onSuccess) onSuccess(content);\n            }\n          }}\n        />\n      }\n    </>\n  );\n};\n"],"mappings":"AAAA,SAA8BA,QAA9B,QAAyD,cAAzD;AACA,OAAOC,KAAP,IAAgBC,SAAhB,EAA2BC,MAA3B,QAAyC,OAAzC;AACA,OAAOC,0BAAP,MAAuC,gDAAvC;AACA,SAASC,OAAT,QAAwB,sBAAxB;AACA,SAASC,oBAAT,QAAqC,2BAArC;AACA,OAAO,KAAKC,8BAAZ,MAAgD,yCAAhD;AACA,OAAO,KAAKC,iCAAZ,MAAmD,4CAAnD;AACA,OAAO,KAAKC,mBAAZ,MAAqC,8BAArC;AASA,MAAMC,IAAI,GAAG;EACXC,SAAS,EAAE;AADA,CAAb;;AAIA,MAAMC,gCAAgC,GAAG,MACvCZ,QAAQ,CAACa,MAAT,CAAgB;EACdC,GAAG,eAAE,oBAAC,0BAAD,OADS;EAEdC,OAAO,EAAE;AAFK,CAAhB,CADF;;AAMA,OAAO,MAAMC,mBAAmB,GAAG,QAKA;EAAA,IALC;IAClCC,GADkC;IAElCC,KAFkC;IAGlCC,OAHkC;IAIlCC;EAJkC,CAKD;EACjC,MAAMC,UAAU,GAAGlB,MAAM,CAAC,IAAD,CAAzB;EACA,MAAMmB,cAAc,GAAG,EAAEZ,IAAI,CAACC,SAA9B,CAFiC,CAIjC;;EAEAT,SAAS,CAAC,MAAM;IACd,MAAMqB,SAAS,GAAI,IAAGD,cAAe,OAAML,GAAG,CAACO,SAAJ,CAAc,CAAd,EAAiB,EAAjB,CAAqB,EAAhE;IAEAC,OAAO,CAACC,GAAR,CAAa,GAAEH,SAAU,oBAAzB;IACA,MAAMI,SAAgC,GAAG,EAAzC;IACAA,SAAS,CAACC,IAAV,CAAerB,8BAA8B,CAACsB,aAA/B,CAA6CR,UAA7C,CAAf;IACAM,SAAS,CAACC,IAAV,CAAepB,iCAAiC,CAACqB,aAAlC,CAAgDR,UAAhD,CAAf;IACAM,SAAS,CAACC,IAAV,CAAenB,mBAAmB,CAACoB,aAApB,CAAkCR,UAAlC,CAAf;IAEA,OAAO,MAAM;MACXI,OAAO,CAACC,GAAR,CAAa,GAAEH,SAAU,uBAAzB;MAEAI,SAAS,CAACG,OAAV,CAAkB,CAACC,QAAD,EAAWC,KAAX,KAAqB;QACrCP,OAAO,CAACC,GAAR,CAAa,GAAEH,SAAU,wBAAuBS,KAAM,EAAtD;QACAD,QAAQ,CAACE,MAAT;MACD,CAHD;IAID,CAPD;EAQD,CAjBQ,EAiBN,CAACZ,UAAD,EAAaC,cAAb,EAA6BL,GAA7B,CAjBM,CAAT;EAmBA,oBACE,0CACGL,gCAAgC,EADnC,eAGI,oBAAC,OAAD;IACE,GAAG,EAAES,UADP;IAEE,MAAM,EAAE;MAAEa,GAAG,EAAEjB;IAAP,CAFV;IAGE,KAAK,EAAE,EAAE,GAAGC;IAAL,CAHT;IAIE,WAAW,EAAE,QAJf;IAKE,SAAS,EAAGiB,GAAD,IACT7B,oBAAoB,CAACgB,cAAD,EAAiBD,UAAjB,EAA6Bc,GAA7B,CANxB;IAQE,2BAA2B,EAAC,sBAR9B;IASE,yBAAyB,EAAE,IAT7B;IAUE,+BAA+B,EAAE,OAVnC;IAWE,SAAS,EAAGC,OAAD,IAAkB;MAC3B;MACA,IAAI,OAAOA,OAAO,CAACC,WAAR,CAAoBC,IAA3B,KAAoC,WAAxC,EAAqD;QACnD,IAAInB,OAAJ,EAAaA,OAAO,CAACiB,OAAD,CAAP;MACd,CAFD,MAEO;QACL,IAAIhB,SAAJ,EAAeA,SAAS,CAACgB,OAAD,CAAT;MAChB;IACF;EAlBH,EAHJ,CADF;AA2BD,CAzDM"}