{"version":3,"names":["Platform","NativeModules","SafeAreaView","View","FlatList","React","useEffect","useRef","useCallback","BBBN_SystemBroadcastPicker","WebView","handleWebviewMessage","onScreenShareLocalIceCandidate","onScreenShareSignalingStateChange","onBroadcastFinished","data","instances","renderPlatformSpecificComponents","select","ios","android","BigBlueButtonTablet","url","style","onError","onSuccess","callState","onShouldStartLoadWithRequest","injectedJavaScript","onNavigationStateChange","onOpenWindow","renderTabItem","currentTab","tabsData","webViewRef","thisInstanceId","logPrefix","substring","console","log","listeners","push","setupListener","forEach","listener","index","remove","OS","BBBN_ScreenShareService","handleBackPress","renderItem","item","flex","length","flexDirection","id","toString","_","offset","uri","marginTop","msg","content","nativeEvent","code"],"sources":["index.tsx"],"sourcesContent":["import {\n  EmitterSubscription,\n  Platform,\n  ViewStyle,\n  NativeModules,\n  SafeAreaView,\n  View,\n  FlatList,\n} from 'react-native';\nimport React, { useEffect, useRef, useCallback } from 'react';\nimport BBBN_SystemBroadcastPicker from './native-components/BBBN_SystemBroadcastPicker';\nimport { WebView } from 'react-native-webview';\nimport { handleWebviewMessage } from './webview/message-handler';\nimport * as onScreenShareLocalIceCandidate from './events/onScreenShareLocalIceCandidate';\nimport * as onScreenShareSignalingStateChange from './events/onScreenShareSignalingStateChange';\nimport * as onBroadcastFinished from './events/onBroadcastFinished';\n\ntype BigBlueButtonTabletSdkProps = {\n  url: string;\n  style: ViewStyle;\n  onError?: (content: any) => void;\n  onSuccess?: (content: any) => void;\n  callState?: any;\n  onShouldStartLoadWithRequest?: (navState: any) => boolean;\n  injectedJavaScript?: string;\n  onNavigationStateChange?: (navState: any) => void;\n  onOpenWindow?: (event: any) => void;\n  renderTabItem?: ({\n    item,\n  }: {\n    item: { id: number; url: string };\n  }) => React.ReactElement | null;\n  currentTab?: any;\n  tabsData?: any;\n};\n\nconst data = {\n  instances: 0,\n};\n\nconst renderPlatformSpecificComponents = () =>\n  Platform.select({\n    ios: <BBBN_SystemBroadcastPicker />,\n    android: null,\n  });\n\nexport const BigBlueButtonTablet = ({\n  url,\n  style,\n  onError,\n  onSuccess,\n  callState,\n  onShouldStartLoadWithRequest,\n  injectedJavaScript,\n  onNavigationStateChange,\n  onOpenWindow,\n  renderTabItem,\n  currentTab,\n  tabsData,\n}: BigBlueButtonTabletSdkProps) => {\n  const webViewRef = useRef<WebView>(null);\n  const thisInstanceId = ++data.instances;\n\n  useEffect(() => {\n    const logPrefix = `[${thisInstanceId}] - ${url.substring(8, 16)}`;\n\n    console.log(`${logPrefix} - addingListeners`);\n    const listeners: EmitterSubscription[] = [];\n    listeners.push(onScreenShareLocalIceCandidate.setupListener(webViewRef));\n    listeners.push(onScreenShareSignalingStateChange.setupListener(webViewRef));\n    listeners.push(onBroadcastFinished.setupListener(webViewRef));\n\n    return () => {\n      console.log(`${logPrefix} - Removing listeners`);\n\n      listeners.forEach((listener, index) => {\n        console.log(`${logPrefix} - Removing listener ${index}`);\n        listener.remove();\n      });\n    };\n  }, [webViewRef, thisInstanceId, url]);\n\n  useEffect(() => {\n    return () => {\n      if (Platform.OS === 'android') {\n        NativeModules.BBBN_ScreenShareService.handleBackPress();\n      }\n    };\n  }, []);\n  const renderItem = useCallback(\n    ({ item }: { item: { id: number; url: string } }) => {\n      if (renderTabItem) {\n        return renderTabItem({ item });\n      }\n      return null;\n    },\n    [renderTabItem]\n  );\n\n  return (\n    <SafeAreaView style={{ flex: 1 }}>\n      {tabsData?.length > 1 && (\n        <View style={{ flexDirection: 'row' }}>\n          <FlatList\n            horizontal\n            data={tabsData}\n            renderItem={renderItem}\n            keyExtractor={(item) => item.id.toString()}\n            initialNumToRender={tabsData.length}\n            getItemLayout={(_, index) => ({\n              length: 100,\n              offset: 100 * index,\n              index,\n            })}\n          />\n        </View>\n      )}\n      <View style={{ flex: 1 }}>\n        {renderPlatformSpecificComponents()}\n\n        <WebView\n          ref={webViewRef}\n          source={{ uri: currentTab?.url || url }}\n          style={{ ...style, marginTop: 0 }}\n          contentMode={'mobile'}\n          onMessage={(msg: any) =>\n            handleWebviewMessage(thisInstanceId, webViewRef, msg, callState)\n          }\n          onOpenWindow={onOpenWindow}\n          applicationNameForUserAgent=\"BigBlueButton-Tablet\"\n          allowsInlineMediaPlayback={true}\n          injectedJavaScript={injectedJavaScript}\n          javaScriptEnabled={true}\n          mediaCapturePermissionGrantType={'grant'}\n          onShouldStartLoadWithRequest={onShouldStartLoadWithRequest}\n          onNavigationStateChange={onNavigationStateChange}\n          onLoadEnd={(content: any) => {\n            if (typeof content.nativeEvent.code !== 'undefined') {\n              if (onError) onError(content);\n            } else {\n              if (onSuccess) onSuccess(content);\n            }\n          }}\n        />\n      </View>\n    </SafeAreaView>\n  );\n};\n"],"mappings":"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"}