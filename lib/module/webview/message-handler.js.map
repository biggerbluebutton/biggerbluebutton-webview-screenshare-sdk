{"version":3,"names":["initializeScreenShare","createScreenShareOffer","setScreenShareRemoteSDP","setFullAudioRemoteSDP","addScreenShareRemoteIceCandidate","createFullAudioOffer","stopScreenShare","observePromiseResult","instanceId","webViewRef","sequence","prom","then","result","console","log","current","injectJavaScript","JSON","stringify","catch","exception","error","handleWebviewMessage","event","callState","stringData","nativeEvent","data","parse","method","promise","arguments","sdp"],"sources":["message-handler.tsx"],"sourcesContent":["import type { MutableRefObject } from 'react';\nimport type { WebView, WebViewMessageEvent } from 'react-native-webview';\nimport initializeScreenShare from '../methods/initializeScreenShare';\nimport createScreenShareOffer from '../methods/createScreenShareOffer';\nimport setScreenShareRemoteSDP from '../methods/setScreenShareRemoteSDP';\nimport setFullAudioRemoteSDP from '../methods/setFullAudioRemoteSDP';\nimport addScreenShareRemoteIceCandidate from '../methods/addScreenShareRemoteIceCandidate';\nimport createFullAudioOffer from '../methods/createFullAudioOffer';\nimport stopScreenShare from '../methods/stopScreenShare';\n\nfunction observePromiseResult(\n  instanceId: Number,\n  webViewRef: MutableRefObject<WebView>,\n  sequence: number,\n  prom: Promise<any>\n) {\n  prom\n    .then((result: any) => {\n      console.log(`[${instanceId}] - Promise ${sequence} resolved!`, result);\n\n      webViewRef.current.injectJavaScript(\n        `window.nativeMethodCallResult(${sequence}, true ${\n          result ? ',' + JSON.stringify(result) : ''\n        });`\n      );\n    })\n    .catch((exception: any) => {\n      console.error(`[${instanceId}] - Promise ${sequence} failed!`, exception);\n      webViewRef.current.injectJavaScript(\n        `window.nativeMethodCallResult(${sequence}, false ${\n          exception ? ',' + JSON.stringify(exception) : ''\n        });`\n      );\n    });\n}\n\nexport function handleWebviewMessage(\n  instanceId: Number,\n  webViewRef: MutableRefObject<any>,\n  event: WebViewMessageEvent,\n  callState?: any\n) {\n  const stringData = event?.nativeEvent?.data;\n  const data = JSON.parse(stringData);\n  console.log('handleWebviewMessage - ', instanceId);\n\n  callState(data?.method);\n  if (data?.method && data?.sequence) {\n    let promise;\n    switch (data?.method) {\n      case 'initializeScreenShare':\n        promise = initializeScreenShare(instanceId);\n        break;\n      case 'createFullAudioOffer':\n        promise = createFullAudioOffer(\n          instanceId,\n          JSON.stringify(data?.arguments[0])\n        );\n        break;\n      case 'createScreenShareOffer':\n        promise = createScreenShareOffer(\n          instanceId,\n          JSON.stringify(data?.arguments[0])\n        );\n        break;\n      case 'setScreenShareRemoteSDP':\n        promise = setScreenShareRemoteSDP(instanceId, data?.arguments[0].sdp);\n        break;\n      case 'setFullAudioRemoteSDP':\n        promise = setFullAudioRemoteSDP(instanceId, data?.arguments[0].sdp);\n        break;\n      case 'addRemoteIceCandidate':\n        promise = addScreenShareRemoteIceCandidate(\n          instanceId,\n          JSON.stringify(data?.arguments[0])\n        );\n        break;\n      case 'stopScreenShare':\n        promise = stopScreenShare(instanceId);\n        break;\n      default:\n        throw `[${instanceId}] - Unknown method ${data?.method}`;\n    }\n    observePromiseResult(instanceId, webViewRef, data.sequence, promise);\n  } else {\n    console.log(`[${instanceId}] - Ignoring unknown message: $stringData`);\n  }\n}\n\nexport default { handleWebviewMessage };\n"],"mappings":"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"}