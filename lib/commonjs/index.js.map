{"version":3,"names":["data","instances","renderPlatformSpecificComponents","Platform","select","ios","android","BigBlueButtonTablet","url","style","onError","onSuccess","webViewRef","useRef","thisInstanceId","useEffect","logPrefix","substring","console","log","listeners","push","onScreenShareLocalIceCandidate","setupListener","onScreenShareSignalingStateChange","onBroadcastFinished","forEach","listener","index","remove","uri","msg","handleWebviewMessage","content","nativeEvent","code"],"sources":["index.tsx"],"sourcesContent":["import { EmitterSubscription, Platform, ViewStyle } from 'react-native';\nimport React, { useEffect, useRef } from 'react';\nimport BBBN_SystemBroadcastPicker from './native-components/BBBN_SystemBroadcastPicker';\nimport { WebView } from 'react-native-webview';\nimport { handleWebviewMessage } from './webview/message-handler';\nimport * as onScreenShareLocalIceCandidate from './events/onScreenShareLocalIceCandidate';\nimport * as onScreenShareSignalingStateChange from './events/onScreenShareSignalingStateChange';\nimport * as onBroadcastFinished from './events/onBroadcastFinished';\n\ntype BigBlueButtonTabletSdkProps = {\n  url: string;\n  style: ViewStyle;\n  onError?: any;\n  onSuccess?: any;\n};\n\nconst data = {\n  instances: 0,\n};\n\nconst renderPlatformSpecificComponents = () =>\n  Platform.select({\n    ios: <BBBN_SystemBroadcastPicker />,\n    android: null,\n  });\n\nexport const BigBlueButtonTablet = ({\n  url,\n  style,\n  onError,\n  onSuccess,\n}: BigBlueButtonTabletSdkProps) => {\n  const webViewRef = useRef(null);\n  const thisInstanceId = ++data.instances;\n\n  // console.log(\"XXX - \", thisInstanceId);\n\n  useEffect(() => {\n    const logPrefix = `[${thisInstanceId}] - ${url.substring(8, 16)}`;\n\n    console.log(`${logPrefix} - addingListeners`);\n    const listeners: EmitterSubscription[] = [];\n    listeners.push(onScreenShareLocalIceCandidate.setupListener(webViewRef));\n    listeners.push(onScreenShareSignalingStateChange.setupListener(webViewRef));\n    listeners.push(onBroadcastFinished.setupListener(webViewRef));\n\n    return () => {\n      console.log(`${logPrefix} - Removing listeners`);\n\n      listeners.forEach((listener, index) => {\n        console.log(`${logPrefix} - Removing listener ${index}`);\n        listener.remove();\n      });\n    };\n  }, [webViewRef, thisInstanceId, url]);\n\n  return (\n    <>\n      {renderPlatformSpecificComponents()}\n      {\n        <WebView\n          ref={webViewRef}\n          source={{ uri: url }}\n          style={{ ...style }}\n          contentMode={'mobile'}\n          onMessage={(msg: any) =>\n            handleWebviewMessage(thisInstanceId, webViewRef, msg)\n          }\n          applicationNameForUserAgent=\"BigBlueButton-Tablet\"\n          allowsInlineMediaPlayback={true}\n          mediaCapturePermissionGrantType={'grant'}\n          onLoadEnd={(content: any) => {\n            /*in case of success, the property code is not defined*/\n            if (typeof content.nativeEvent.code !== 'undefined') {\n              if (onError) onError(content);\n            } else {\n              if (onSuccess) onSuccess(content);\n            }\n          }}\n        />\n      }\n    </>\n  );\n};\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AASA,MAAMA,IAAI,GAAG;EACXC,SAAS,EAAE;AADA,CAAb;;AAIA,MAAMC,gCAAgC,GAAG,MACvCC,qBAAA,CAASC,MAAT,CAAgB;EACdC,GAAG,eAAE,6BAAC,mCAAD,OADS;EAEdC,OAAO,EAAE;AAFK,CAAhB,CADF;;AAMO,MAAMC,mBAAmB,GAAG,QAKA;EAAA,IALC;IAClCC,GADkC;IAElCC,KAFkC;IAGlCC,OAHkC;IAIlCC;EAJkC,CAKD;EACjC,MAAMC,UAAU,GAAG,IAAAC,aAAA,EAAO,IAAP,CAAnB;EACA,MAAMC,cAAc,GAAG,EAAEd,IAAI,CAACC,SAA9B,CAFiC,CAIjC;;EAEA,IAAAc,gBAAA,EAAU,MAAM;IACd,MAAMC,SAAS,GAAI,IAAGF,cAAe,OAAMN,GAAG,CAACS,SAAJ,CAAc,CAAd,EAAiB,EAAjB,CAAqB,EAAhE;IAEAC,OAAO,CAACC,GAAR,CAAa,GAAEH,SAAU,oBAAzB;IACA,MAAMI,SAAgC,GAAG,EAAzC;IACAA,SAAS,CAACC,IAAV,CAAeC,8BAA8B,CAACC,aAA/B,CAA6CX,UAA7C,CAAf;IACAQ,SAAS,CAACC,IAAV,CAAeG,iCAAiC,CAACD,aAAlC,CAAgDX,UAAhD,CAAf;IACAQ,SAAS,CAACC,IAAV,CAAeI,mBAAmB,CAACF,aAApB,CAAkCX,UAAlC,CAAf;IAEA,OAAO,MAAM;MACXM,OAAO,CAACC,GAAR,CAAa,GAAEH,SAAU,uBAAzB;MAEAI,SAAS,CAACM,OAAV,CAAkB,CAACC,QAAD,EAAWC,KAAX,KAAqB;QACrCV,OAAO,CAACC,GAAR,CAAa,GAAEH,SAAU,wBAAuBY,KAAM,EAAtD;QACAD,QAAQ,CAACE,MAAT;MACD,CAHD;IAID,CAPD;EAQD,CAjBD,EAiBG,CAACjB,UAAD,EAAaE,cAAb,EAA6BN,GAA7B,CAjBH;EAmBA,oBACE,4DACGN,gCAAgC,EADnC,eAGI,6BAAC,2BAAD;IACE,GAAG,EAAEU,UADP;IAEE,MAAM,EAAE;MAAEkB,GAAG,EAAEtB;IAAP,CAFV;IAGE,KAAK,EAAE,EAAE,GAAGC;IAAL,CAHT;IAIE,WAAW,EAAE,QAJf;IAKE,SAAS,EAAGsB,GAAD,IACT,IAAAC,oCAAA,EAAqBlB,cAArB,EAAqCF,UAArC,EAAiDmB,GAAjD,CANJ;IAQE,2BAA2B,EAAC,sBAR9B;IASE,yBAAyB,EAAE,IAT7B;IAUE,+BAA+B,EAAE,OAVnC;IAWE,SAAS,EAAGE,OAAD,IAAkB;MAC3B;MACA,IAAI,OAAOA,OAAO,CAACC,WAAR,CAAoBC,IAA3B,KAAoC,WAAxC,EAAqD;QACnD,IAAIzB,OAAJ,EAAaA,OAAO,CAACuB,OAAD,CAAP;MACd,CAFD,MAEO;QACL,IAAItB,SAAJ,EAAeA,SAAS,CAACsB,OAAD,CAAT;MAChB;IACF;EAlBH,EAHJ,CADF;AA2BD,CAzDM"}