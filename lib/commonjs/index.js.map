{"version":3,"names":["data","instances","renderPlatformSpecificComponents","Platform","select","ios","android","BigBlueButtonTablet","url","style","onError","onSuccess","callState","onShouldStartLoadWithRequest","injectedJavaScript","onNavigationStateChange","onOpenWindow","renderTabItem","currentTab","tabsData","webViewRef","useRef","thisInstanceId","useEffect","logPrefix","substring","console","log","listeners","push","onScreenShareLocalIceCandidate","setupListener","onScreenShareSignalingStateChange","onBroadcastFinished","forEach","listener","index","remove","OS","NativeModules","BBBN_ScreenShareService","handleBackPress","renderItem","useCallback","item","flex","length","flexDirection","id","toString","_","offset","uri","marginTop","msg","handleWebviewMessage","content","nativeEvent","code"],"sources":["index.tsx"],"sourcesContent":["import {\n  EmitterSubscription,\n  Platform,\n  ViewStyle,\n  NativeModules,\n  SafeAreaView,\n  View,\n  FlatList,\n} from 'react-native';\nimport React, { useEffect, useRef, useCallback } from 'react';\nimport BBBN_SystemBroadcastPicker from './native-components/BBBN_SystemBroadcastPicker';\nimport { WebView } from 'react-native-webview';\nimport { handleWebviewMessage } from './webview/message-handler';\nimport * as onScreenShareLocalIceCandidate from './events/onScreenShareLocalIceCandidate';\nimport * as onScreenShareSignalingStateChange from './events/onScreenShareSignalingStateChange';\nimport * as onBroadcastFinished from './events/onBroadcastFinished';\n\ntype BigBlueButtonTabletSdkProps = {\n  url: string;\n  style: ViewStyle;\n  onError?: (content: any) => void;\n  onSuccess?: (content: any) => void;\n  callState?: any;\n  onShouldStartLoadWithRequest?: (navState: any) => boolean;\n  injectedJavaScript?: string;\n  onNavigationStateChange?: (navState: any) => void;\n  onOpenWindow?: (event: any) => void;\n  renderTabItem?: ({\n    item,\n  }: {\n    item: { id: number; url: string };\n  }) => React.ReactElement | null;\n  currentTab?: any;\n  tabsData?: any;\n};\n\nconst data = {\n  instances: 0,\n};\n\nconst renderPlatformSpecificComponents = () =>\n  Platform.select({\n    ios: <BBBN_SystemBroadcastPicker />,\n    android: null,\n  });\n\nexport const BigBlueButtonTablet = ({\n  url,\n  style,\n  onError,\n  onSuccess,\n  callState,\n  onShouldStartLoadWithRequest,\n  injectedJavaScript,\n  onNavigationStateChange,\n  onOpenWindow,\n  renderTabItem,\n  currentTab,\n  tabsData,\n}: BigBlueButtonTabletSdkProps) => {\n  const webViewRef = useRef<WebView>(null);\n  const thisInstanceId = ++data.instances;\n\n  useEffect(() => {\n    const logPrefix = `[${thisInstanceId}] - ${url.substring(8, 16)}`;\n\n    console.log(`${logPrefix} - addingListeners`);\n    const listeners: EmitterSubscription[] = [];\n    listeners.push(onScreenShareLocalIceCandidate.setupListener(webViewRef));\n    listeners.push(onScreenShareSignalingStateChange.setupListener(webViewRef));\n    listeners.push(onBroadcastFinished.setupListener(webViewRef));\n\n    return () => {\n      console.log(`${logPrefix} - Removing listeners`);\n\n      listeners.forEach((listener, index) => {\n        console.log(`${logPrefix} - Removing listener ${index}`);\n        listener.remove();\n      });\n    };\n  }, [webViewRef, thisInstanceId, url]);\n\n  useEffect(() => {\n    return () => {\n      if (Platform.OS === 'android') {\n        NativeModules.BBBN_ScreenShareService.handleBackPress();\n      }\n    };\n  }, []);\n  const renderItem = useCallback(\n    ({ item }: { item: { id: number; url: string } }) => {\n      if (renderTabItem) {\n        return renderTabItem({ item });\n      }\n      return null;\n    },\n    [renderTabItem]\n  );\n\n  return (\n    <SafeAreaView style={{ flex: 1 }}>\n      {tabsData?.length > 1 && (\n        <View style={{ flexDirection: 'row' }}>\n          <FlatList\n            horizontal\n            data={tabsData}\n            renderItem={renderItem}\n            keyExtractor={(item) => item.id.toString()}\n            initialNumToRender={tabsData.length}\n            getItemLayout={(_, index) => ({\n              length: 100,\n              offset: 100 * index,\n              index,\n            })}\n          />\n        </View>\n      )}\n      <View style={{ flex: 1 }}>\n        {renderPlatformSpecificComponents()}\n\n        <WebView\n          ref={webViewRef}\n          source={{ uri: currentTab?.url || url }}\n          style={{ ...style, marginTop: 0 }}\n          contentMode={'mobile'}\n          onMessage={(msg: any) =>\n            handleWebviewMessage(thisInstanceId, webViewRef, msg, callState)\n          }\n          onOpenWindow={onOpenWindow}\n          applicationNameForUserAgent=\"BigBlueButton-Tablet\"\n          allowsInlineMediaPlayback={true}\n          injectedJavaScript={injectedJavaScript}\n          javaScriptEnabled={true}\n          mediaCapturePermissionGrantType={'grant'}\n          onShouldStartLoadWithRequest={onShouldStartLoadWithRequest}\n          onNavigationStateChange={onNavigationStateChange}\n          onLoadEnd={(content: any) => {\n            if (typeof content.nativeEvent.code !== 'undefined') {\n              if (onError) onError(content);\n            } else {\n              if (onSuccess) onSuccess(content);\n            }\n          }}\n        />\n      </View>\n    </SafeAreaView>\n  );\n};\n"],"mappings":"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"}