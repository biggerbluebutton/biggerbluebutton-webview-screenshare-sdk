{"version":3,"names":["_reactNative","require","_react","_interopRequireWildcard","_BBBN_SystemBroadcastPicker","_interopRequireDefault","_reactNativeWebview","_messageHandler","onScreenShareLocalIceCandidate","onScreenShareSignalingStateChange","onBroadcastFinished","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","data","instances","renderPlatformSpecificComponents","Platform","select","ios","createElement","android","BigBlueButtonTablet","url","style","onError","onSuccess","setCallState","onShouldStartLoadWithRequest","injectedJavaScript","onNavigationStateChange","onOpenWindow","renderTabItem","currentTab","tabsData","webViewRef","useRef","thisInstanceId","TARGET_SCALE","zoomOutBeforeLoad","autoFitAfterLoad","useEffect","logPrefix","substring","console","log","listeners","push","setupListener","forEach","listener","index","remove","OS","NativeModules","BBBN_ScreenShareService","handleBackPress","renderItem","useCallback","item","SafeAreaView","flex","length","View","flexDirection","FlatList","horizontal","keyExtractor","id","toString","initialNumToRender","getItemLayout","_","offset","WebView","ref","source","uri","marginTop","contentMode","applicationNameForUserAgent","allowsInlineMediaPlayback","javaScriptEnabled","mediaCapturePermissionGrantType","scrollEnabled","bounces","nestedScrollEnabled","overScrollMode","injectedJavaScriptBeforeContentLoaded","onMessage","msg","handleWebviewMessage","onLoadEnd","content","nativeEvent","code","exports"],"sources":["index.tsx"],"sourcesContent":["import {\n  EmitterSubscription,\n  Platform,\n  ViewStyle,\n  NativeModules,\n  SafeAreaView,\n  View,\n  FlatList,\n} from 'react-native';\nimport React, { useEffect, useRef, useCallback } from 'react';\nimport BBBN_SystemBroadcastPicker from './native-components/BBBN_SystemBroadcastPicker';\nimport { WebView } from 'react-native-webview';\nimport { handleWebviewMessage } from './webview/message-handler';\nimport * as onScreenShareLocalIceCandidate from './events/onScreenShareLocalIceCandidate';\nimport * as onScreenShareSignalingStateChange from './events/onScreenShareSignalingStateChange';\nimport * as onBroadcastFinished from './events/onBroadcastFinished';\n\ntype BigBlueButtonTabletSdkProps = {\n  url: string;\n  style: ViewStyle;\n  onError?: (content: any) => void;\n  onSuccess?: (content: any) => void;\n  setCallState?: any;\n  onShouldStartLoadWithRequest?: (navState: any) => boolean;\n  injectedJavaScript?: string;\n  onNavigationStateChange?: (navState: any) => void;\n  onOpenWindow?: (event: any) => void;\n  renderTabItem?: ({\n    item,\n  }: {\n    item: { id: number; url: string };\n  }) => React.ReactElement | null;\n  currentTab?: any;\n  tabsData?: any;\n};\n\nconst data = {\n  instances: 0,\n};\n\nconst renderPlatformSpecificComponents = () =>\n  Platform.select({\n    ios: <BBBN_SystemBroadcastPicker />,\n    android: null,\n  });\n\nexport const BigBlueButtonTablet = ({\n  url,\n  style,\n  onError,\n  onSuccess,\n  setCallState,\n  onShouldStartLoadWithRequest,\n  injectedJavaScript,\n  onNavigationStateChange,\n  onOpenWindow,\n  renderTabItem,\n  currentTab,\n  tabsData,\n}: BigBlueButtonTabletSdkProps) => {\n  const webViewRef = useRef<WebView>(null);\n  const thisInstanceId = ++data.instances;\n  const TARGET_SCALE = 0.85;\n  const zoomOutBeforeLoad = `\n  (function(){\n    try {\n      var s=${TARGET_SCALE};\n      var meta = document.querySelector('meta[name=\"viewport\"]');\n      if (!meta) {\n        meta = document.createElement('meta');\n        meta.name = 'viewport';\n        document.head.appendChild(meta);\n      }\n      // Set an initial zoom-out, allow pinch-zoom afterwards\n      meta.content = 'width=device-width, initial-scale=' + s + ', minimum-scale=0.5, maximum-scale=3, user-scalable=yes, viewport-fit=cover';\n      document.documentElement.style.overflowY = 'auto';\n      document.body.style.overflowY = 'auto';\n      document.documentElement.style.height = 'auto';\n      document.body.style.height = 'auto';\n    } catch(e) {}\n  })();\n  true;\n  `;\n\n  const autoFitAfterLoad = `\n(function(){\n  try {\n    var s=${TARGET_SCALE};\n    var floor = 0.75;   // don't go below 75%\n    var step  = 0.05;   // shrink by 5% per pass\n    function setViewportScale(x){\n      var m = document.querySelector('meta[name=\"viewport\"]');\n      if (!m) return;\n      m.content = 'width=device-width, initial-scale=' + x + ', minimum-scale=0.5, maximum-scale=3, user-scalable=yes, viewport-fit=cover';\n    }\n    function applyTransformFallback(x){\n      // Final fallback: visually scale everything and widen layout to avoid cropping\n      var html = document.documentElement, body = document.body;\n      html.style.transformOrigin = 'top left';\n      html.style.transform = 'scale(' + x + ')';\n      html.style.width = (100/x) + 'vw';\n      body.style.width = (100/x) + 'vw';\n      html.style.height = 'auto';\n      body.style.height = 'auto';\n      // ensure nothing hides under a footer\n      body.style.paddingBottom = '12px';\n    }\n    function fits(){\n      var H = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);\n      var C = Math.max(document.documentElement.clientHeight, window.innerHeight||0);\n      return H <= C + 2; // allow tiny rounding\n    }\n    function tryFit(){\n      if (fits()) return;\n      if (s > floor) {\n        s = Math.max(floor, s - step);\n        setViewportScale(s);\n        setTimeout(tryFit, 120);\n      } else {\n        // Still taller? Force visual scale.\n        applyTransformFallback(s);\n      }\n    }\n    // kick after layout stabilizes\n    setTimeout(tryFit, 120);\n  } catch(e){}\n})();\ntrue;\n`;\n\n  useEffect(() => {\n    const logPrefix = `[${thisInstanceId}] - ${url.substring(8, 16)}`;\n\n    console.log(`${logPrefix} - addingListeners`);\n    const listeners: EmitterSubscription[] = [];\n    listeners.push(onScreenShareLocalIceCandidate.setupListener(webViewRef));\n    listeners.push(onScreenShareSignalingStateChange.setupListener(webViewRef));\n    listeners.push(onBroadcastFinished.setupListener(webViewRef));\n\n    return () => {\n      console.log(`${logPrefix} - Removing listeners`);\n\n      listeners.forEach((listener, index) => {\n        console.log(`${logPrefix} - Removing listener ${index}`);\n        listener.remove();\n      });\n    };\n  }, [webViewRef, thisInstanceId, url]);\n\n  useEffect(() => {\n    return () => {\n      if (Platform.OS === 'android') {\n        NativeModules.BBBN_ScreenShareService.handleBackPress();\n      }\n    };\n  }, []);\n  const renderItem = useCallback(\n    ({ item }: { item: { id: number; url: string } }) => {\n      if (renderTabItem) {\n        return renderTabItem({ item });\n      }\n      return null;\n    },\n    [renderTabItem]\n  );\n\n  return (\n    <SafeAreaView style={{ flex: 1 }}>\n      {tabsData?.length > 1 && (\n        <View style={{ flexDirection: 'row' }}>\n          <FlatList\n            horizontal\n            data={tabsData}\n            renderItem={renderItem}\n            keyExtractor={(item) => item.id.toString()}\n            initialNumToRender={tabsData.length}\n            getItemLayout={(_, index) => ({\n              length: 100,\n              offset: 100 * index,\n              index,\n            })}\n          />\n        </View>\n      )}\n      <View style={{ flex: 1 }}>\n        {renderPlatformSpecificComponents()}\n\n        <WebView\n          ref={webViewRef}\n          source={{ uri: currentTab?.url || url }}\n          style={{ ...style, flex: 1, marginTop: 0 }}\n          contentMode=\"mobile\"\n          applicationNameForUserAgent=\"BigBlueButton-Tablet\"\n          allowsInlineMediaPlayback\n          javaScriptEnabled\n          mediaCapturePermissionGrantType=\"grant\"\n          scrollEnabled\n          bounces\n          // automaticallyAdjustContentInsets={false}\n          // contentInsetAdjustmentBehavior=\"never\"\n          nestedScrollEnabled\n          overScrollMode=\"always\"\n          // setSupportMultipleWindows={false}\n          onOpenWindow={onOpenWindow}\n          injectedJavaScriptBeforeContentLoaded={zoomOutBeforeLoad}\n          injectedJavaScript={autoFitAfterLoad && injectedJavaScript}\n          onMessage={(msg) =>\n            handleWebviewMessage(0, webViewRef, msg, setCallState)\n          }\n          onShouldStartLoadWithRequest={onShouldStartLoadWithRequest}\n          onNavigationStateChange={onNavigationStateChange}\n          onLoadEnd={(content: any) => {\n            if (typeof content.nativeEvent.code !== 'undefined') {\n              onError?.(content);\n            } else {\n              onSuccess?.(content);\n            }\n          }}\n        />\n      </View>\n    </SafeAreaView>\n  );\n};\n"],"mappings":"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","ignoreList":[]}